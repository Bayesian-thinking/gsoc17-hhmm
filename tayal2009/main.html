<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Luis Damiano, Brian Peterson, Michael Weylandt" />

<meta name="date" content="2017-07-29" />

<title>Regime Switching and Technical Trading with Dynamic Bayesian Networks in High-Frequency Stock Markets</title>

\(
% Math operators
\newcommand{\argmax}{\arg\!\max}
\newcommand{\argmin}{\arg\!\min}
\newcommand\ev[1]{E\left\langle#1\right\rangle}
\newcommand\vv[1]{V\left\langle#1\right\rangle}

% Math commands
\newcommand{\mat}[1]{\mathbf{#1}}

% Math symbols
\renewcommand{\NN}{\mathcal{N}}
\renewcommand{\LL}{\mathcal{L}}
\renewcommand{\RR}{\mathbb{R}}
\)


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Regime Switching and Technical Trading with Dynamic Bayesian Networks in High-Frequency Stock Markets</h1>
<h4 class="author"><em>Luis Damiano, Brian Peterson, Michael Weylandt</em></h4>
<h4 class="date"><em>2017-07-29</em></h4>


<div id="TOC">
<ul>
<li><a href="#hierarchical-hidden-markov-models"><span class="toc-section-number">1</span> Hierarchical Hidden Markov Models</a><ul>
<li><a href="#model-specification"><span class="toc-section-number">1.1</span> Model specification</a></li>
<li><a href="#generative-model"><span class="toc-section-number">1.2</span> Generative model</a></li>
<li><a href="#parameter-estimation"><span class="toc-section-number">1.3</span> Parameter estimation</a></li>
<li><a href="#inference"><span class="toc-section-number">1.4</span> Inference</a><ul>
<li><a href="#filtering"><span class="toc-section-number">1.4.1</span> Filtering</a></li>
<li><a href="#smoothing"><span class="toc-section-number">1.4.2</span> Smoothing</a></li>
<li><a href="#most-likely-hidden-path"><span class="toc-section-number">1.4.3</span> Most likely hidden path</a></li>
</ul></li>
<li><a href="#parameter-estimation-1"><span class="toc-section-number">1.5</span> Parameter estimation</a></li>
</ul></li>
<li><a href="#regime-switching-and-technical-trading-with-dynamic-bayesian-networks-in-high-frequency-stock-markets"><span class="toc-section-number">2</span> Regime Switching and Technical Trading with Dynamic Bayesian Networks in High-Frequency Stock Markets</a><ul>
<li><a href="#preamble"><span class="toc-section-number">2.1</span> Preamble</a></li>
<li><a href="#model"><span class="toc-section-number">2.2</span> Model</a></li>
<li><a href="#the-sampler"><span class="toc-section-number">2.3</span> The sampler</a></li>
<li><a href="#dataset-data-transformation"><span class="toc-section-number">2.4</span> Dataset &amp; data transformation</a></li>
<li><a href="#feature-extraction"><span class="toc-section-number">2.5</span> Feature extraction</a></li>
<li><a href="#methodology"><span class="toc-section-number">2.6</span> Methodology</a></li>
<li><a href="#goldcorp-inc-tseg"><span class="toc-section-number">2.7</span> GoldCorp Inc (TSE:G)</a><ul>
<li><a href="#data-exploration"><span class="toc-section-number">2.7.1</span> Data exploration</a></li>
<li><a href="#estimation"><span class="toc-section-number">2.7.2</span> Estimation</a></li>
<li><a href="#convergence"><span class="toc-section-number">2.7.3</span> Convergence</a></li>
<li><a href="#state-probability"><span class="toc-section-number">2.7.4</span> State probability</a></li>
<li><a href="#fitted-output"><span class="toc-section-number">2.7.5</span> Fitted output</a></li>
<li><a href="#in-sample-summary"><span class="toc-section-number">2.7.6</span> In-sample summary</a></li>
<li><a href="#forecast"><span class="toc-section-number">2.7.7</span> Forecast</a></li>
<li><a href="#trading-strategy"><span class="toc-section-number">2.7.8</span> Trading strategy</a></li>
</ul></li>
<li><a href="#further-research"><span class="toc-section-number">2.8</span> Discussion</a><ul>
<li><a href="#the-statistical-model"><span class="toc-section-number">2.8.1</span> The statistical model</a></li>
<li><a href="#the-financial-application"><span class="toc-section-number">2.8.2</span> The financial application</a></li>
</ul></li>
</ul></li>
<li><a href="#original-computing-environment"><span class="toc-section-number">3</span> Original Computing Environment</a></li>
<li><a href="#references">References</a></li>
</ul>
</div>

<style>img{border: 0px !important;}</style>
<p>This work aims at … .</p>
<p>The authors acknowledge Google for financial support via the Google Summer of Code 2017 program.</p>
<hr />
<div id="hierarchical-hidden-markov-models" class="section level1">
<h1><span class="header-section-number">1</span> Hierarchical Hidden Markov Models</h1>
<p>The Hierarchical Hidden Markov Model (HHMM) is a recursive hierarchical generalization of the HMM that provides a systematic unsupervised approach for complex multi-scale structure. The model is motivated by the multiplicity of length scales and the different stochastic levels (recursive nature) present in some sequences. Additionally, it infers correlated observations over long periods via higher levels of hierarchy.</p>
<p>The model structure is fairly general and allows an arbitrary number of activations of its submodels. The multi-resolution structure is handled by temporal experts<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a> of different time scales.</p>
<div id="model-specification" class="section level2">
<h2><span class="header-section-number">1.1</span> Model specification</h2>
<p>HHMM are structured multi-level stochastic processes that generalize HHM by making each of the hidden states an autonomous probabilistic model. There are two kinds of states: internal states are HHMM that emit sequences by a recursive activation of one of the substates, while production states generate an output symbol according to the probability distribution of the set of output symbols.</p>
<p>Hidden dynamics are lead by transitions. Vertical transitions involve the activation of a substate by an internal state, they may include further vertical transitions to lower level states. Once completed, they return the control to the state that originated the recursive activation chain. Then, a horizontal transition is performed. It is state tranistion within the same level.</p>
<p>A HHMM can be represented as a standard single level HMM whose states are the production states of the corresponding HHMM with a fully connected structure, i.e. there is a non-zero probability of tranisition from any state to any other state. This equivalent new model lacks the multi-level structure.</p>
<p>Let <span class="math inline">\(z_{t}^{d} = i\)</span> be the state of an HHMM at the step <span class="math inline">\(t\)</span>, where <span class="math inline">\(i \in \{1, \dots, |z^{d}|\}\)</span> is the state index, <span class="math inline">\(|z^{d}|\)</span> is the number of possible steps within the <span class="math inline">\(d\)</span>-th level and <span class="math inline">\(d \in \{1, \dots, D\}\)</span> is the hierarchy index taking values <span class="math inline">\(d = 1\)</span> for the root state, <span class="math inline">\(d = \{2, \dots, ..., D-1\}\)</span> for the remaining internal states and <span class="math inline">\(d = D\)</span> for the production states.</p>
<p>In addition to its structure, the model is characterized by the state transition probability between the internal states and the output distribution of the production states. For each internal state <span class="math inline">\(z_t^d\)</span> for <span class="math inline">\(d \in \{1, \dots, D - 1\}\)</span>, there is a state transition probability matrix <span class="math inline">\(\mat{A}^d\)</span> with elements <span class="math inline">\(A_{ij}^{d} = p(z_{t}^{d+1} = j | z_{t}^{d+1} = j)\)</span> is the probability of a horizontal transition from the <span class="math inline">\(i\)</span>-th state to the <span class="math inline">\(j\)</span>-th state within the level <span class="math inline">\(d\)</span>. Similarly, there is the initial distribution vector over the substates <span class="math inline">\(\mat{\pi}^d\)</span> with elements <span class="math inline">\(\pi_j^d = p(z_t^{d+1} = j | z_t^d)\)</span> for <span class="math inline">\(d \in \{1, \dots, D - 1\}\)</span>. Finally, each production state <span class="math inline">\(z_t^D\)</span> is parametrized by the output parameter vector <span class="math inline">\(\mat{\theta}_o^i\)</span> whose form depends on the specification of the observation model <span class="math inline">\(p(\mat{x}_t | z_t^D = j, \mat{\theta}_o^j)\)</span> corresponding to the <span class="math inline">\(j\)</span>-th production state.</p>
</div>
<div id="generative-model" class="section level2">
<h2><span class="header-section-number">1.2</span> Generative model</h2>
<p>The root node initiates a stochastic sequence generation. An observation for the first step in the sequence <span class="math inline">\(t\)</span> is generated by drawing at random one of the possible substates according to the initial state distribution <span class="math inline">\(\mat{\pi}^1\)</span>. To replicate the recursive activation process, for each internal state entered <span class="math inline">\(z_t^d\)</span> one of the substates is randomly chosen according to the corresponding initial probability vector <span class="math inline">\(\mat{\pi}^d\)</span>. When an internal state transitions to a production state <span class="math inline">\(z_t^D = j\)</span>, a single observation is generated according to the state output parameter vector <span class="math inline">\(\mat{\theta}_o^j\)</span>. Control returns to the internal state that lead to the current production state <span class="math inline">\(z_t^{D-1}\)</span>, which in turns selects the next state in the same level according to transition matrix <span class="math inline">\(\mat{A}^{D-1}\)</span>.</p>
<p>Save for the top, each level <span class="math inline">\(d \in \{2, \dots, D\}\)</span> has a final state that terminates the stochastic state activation process and returns the control to the parent state of the whole hierarchy. The generation of the observation sequence is completed when control of all the recursive activations returns to the root state.</p>
</div>
<div id="parameter-estimation" class="section level2">
<h2><span class="header-section-number">1.3</span> Parameter estimation</h2>
<p>The parameters of the models are <span class="math inline">\(\mat{\theta} = \left\{ \left\{ \mat{A}^d \right\}_{d \in \{1, \dots, D - 1\}}, \left\{ \mat{\pi}^d \right\}_{d \in \{1, \dots, D - 1\}}, \left\{ \mat{\theta}_o \right\} \right\}\)</span>. The form of <span class="math inline">\(\mat{\theta}_o\)</span> depends on the specification of the production states.</p>
</div>
<div id="inference" class="section level2">
<h2><span class="header-section-number">1.4</span> Inference</h2>
<p>There are several quantities of interest to be estimated via different algorithms. In this section, the discussion assumes that model parameters are known.</p>
<div id="filtering" class="section level3">
<h3><span class="header-section-number">1.4.1</span> Filtering</h3>
<p>A filter infers the belief state at a given step based on all the information available up to that point,</p>
<span class="math display">\[\begin{align*}
\alpha_t(j)
  &amp; \triangleq p(z_t = j | \mat{x}_{1:t}, \mat{u}_{1:t}).
\end{align*}\]</span>
<p>It achieves better noise reduction than simply estimating the hidden state based on the current estimate <span class="math inline">\(p(z_t | \mat{x}_{t})\)</span>. The filtering process can be run online, or recursively, as new data streams in. Filtered marginals can be computed recursively by means of the forward algorithm <span class="citation">(Baum and Eagon 1967)</span>.</p>
</div>
<div id="smoothing" class="section level3">
<h3><span class="header-section-number">1.4.2</span> Smoothing</h3>
<p>A smoother infers the belief state at a given step based on all the observations or evidence,</p>
<p><span class="math display">\[
\begin{align*}
\gamma_t(j)
  &amp; \triangleq p(z_t = j | \mat{x}_{1:T}, \mat{u}_{1:T}) \\
  &amp; \propto \alpha_t(j) \beta_t(j),
\end{align*}
\]</span></p>
<p>where</p>
<span class="math display">\[\begin{align*}
\beta_{t-1}(i)
  &amp; \triangleq p(\mat{x}_{t:T} | z_{t-1} = i, \mat{u}_{t:T}).
\end{align*}\]</span>
<p>Although noise and uncertainty are reduced as a result of conditioning on past and future data, the smoothing process can only be run offline. Inference can be run by means of the forwards-backwards algorithm, also know as the Baum-Welch algorithm <span class="citation">(Baum and Eagon 1967, <span class="citation">Baum et al. (1970)</span>)</span>.</p>
</div>
<div id="most-likely-hidden-path" class="section level3">
<h3><span class="header-section-number">1.4.3</span> Most likely hidden path</h3>
<p>It is also of interest to compute the most probable state sequence or path,</p>
<p><span class="math display">\[
\mat{z}^* = \argmax_{\mat{z}_{1:T}} p(\mat{z}_{1:T} | \mat{x}_{1:T}).
\]</span></p>
<p>The jointly most probable sequence of states can be inferred by means of maximum a posterior (MAP) estimation or Viterbi decoding.</p>
</div>
</div>
<div id="parameter-estimation-1" class="section level2">
<h2><span class="header-section-number">1.5</span> Parameter estimation</h2>
<p>The parameters of the models are <span class="math inline">\(\mat{\theta} = (\mat{\pi}_1, \mat{\theta}_h, \mat{\theta}_o)\)</span>, where <span class="math inline">\(\mat{\pi}_1\)</span> is the initial state distribution, <span class="math inline">\(\mat{\theta}_h\)</span> are the parameters of the hidden model and <span class="math inline">\(\mat{\theta}_o\)</span> are the parameters of the state-conditional density function <span class="math inline">\(p(\mat{x}_t | z_t = j, \mat{u}_t)\)</span>. The form of <span class="math inline">\(\mat{\theta}_h\)</span> and <span class="math inline">\(\mat{\theta}_o\)</span> depends on the specification of each model. For example, state transition may be characterized by a logistic or multinomial regression with parameters <span class="math inline">\(\mat{w}_k\)</span> for <span class="math inline">\(k \in \{1, \dots, K\}\)</span>, while emissions may be modeled by a linear regression with Gaussian error with parameters <span class="math inline">\(\mat{b}_k\)</span> and <span class="math inline">\(\mat{\Sigma}_k\)</span> for <span class="math inline">\(k \in \{1, \dots, K\}\)</span>.</p>
<hr />
</div>
</div>
<div id="regime-switching-and-technical-trading-with-dynamic-bayesian-networks-in-high-frequency-stock-markets" class="section level1">
<h1><span class="header-section-number">2</span> Regime Switching and Technical Trading with Dynamic Bayesian Networks in High-Frequency Stock Markets</h1>
<div id="preamble" class="section level2">
<h2><span class="header-section-number">2.1</span> Preamble</h2>
<p>…</p>
</div>
<div id="model" class="section level2">
<h2><span class="header-section-number">2.2</span> Model</h2>
<p>We adhere to the methodology proposed in the original work as much as possible. We set up an IOHMM model with <span class="math inline">\(K = 4\)</span> hidden states to forecast stock prices. The hidden dynamics are driven by a multinomial (softmax) regression with <span class="math inline">\(R = 4\)</span> inputs, namely opening, closing, highest and lowest prices from the previous time step. The univariate output is the stock closing price for the current time step. The observation model is a Gaussian mixture with <span class="math inline">\(L = 3\)</span> components per state,</p>
<p><span class="math display">\[
p(x_t | z_{t} = j) = \sum_{l = 1}^{L}{\lambda_{jl} \ \NN(x_t | \mu_{jl}, \sigma_{jl})},
\]</span></p>
<p>where <span class="math inline">\(\lambda_{jl}\)</span> is the component weight for the <span class="math inline">\(l\)</span>-th component within the <span class="math inline">\(j\)</span>-th state, <span class="math inline">\(0 \le \lambda_{jl} \le 1 \ \forall \ l, j\)</span> and <span class="math inline">\(\sum_{l=1}^{L}{\lambda_{jl}} = 1 \ \forall \ j\)</span>.</p>
<p>The vector parameter then becomes <span class="math inline">\(\mat{\theta} = (\mat{\pi}_1, \mat{w}_k, \lambda_{kl}, \mu_{kl}, \sigma_{kl})\)</span> for <span class="math inline">\(k \in \{1, \dots, K\}\)</span> and <span class="math inline">\(l \in \{1, \dots, L\}\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">K =<span class="st"> </span><span class="dv">4</span>
L =<span class="st"> </span><span class="dv">3</span></code></pre></div>
</div>
<div id="the-sampler" class="section level2">
<h2><span class="header-section-number">2.3</span> The sampler</h2>
<p>…</p>
</div>
<div id="dataset-data-transformation" class="section level2">
<h2><span class="header-section-number">2.4</span> Dataset &amp; data transformation</h2>
<p>We use daily OHLC prices for the stocks and time spans listed in the original paper. The data is downloaded from Yahoo Finance via Quantmod. We omit two delisted stocks as the series are not avaliable anymore in public sources such as Yahoo and Google Finance.</p>
<p>…</p>
</div>
<div id="feature-extraction" class="section level2">
<h2><span class="header-section-number">2.5</span> Feature extraction</h2>
<p>…</p>
</div>
<div id="methodology" class="section level2">
<h2><span class="header-section-number">2.6</span> Methodology</h2>
<p>…</p>
</div>
<div id="goldcorp-inc-tseg" class="section level2">
<h2><span class="header-section-number">2.7</span> GoldCorp Inc (TSE:G)</h2>
<p>We present an in-depth study of one stock, TSE:G, to assess the strengths and weaknesses of the model.</p>
<div id="data-exploration" class="section level3">
<h3><span class="header-section-number">2.7.1</span> Data exploration</h3>
<p>…</p>
</div>
<div id="estimation" class="section level3">
<h3><span class="header-section-number">2.7.2</span> Estimation</h3>
<p>…</p>
</div>
<div id="convergence" class="section level3">
<h3><span class="header-section-number">2.7.3</span> Convergence</h3>
<p>…</p>
</div>
<div id="state-probability" class="section level3">
<h3><span class="header-section-number">2.7.4</span> State probability</h3>
<p>…</p>
</div>
<div id="fitted-output" class="section level3">
<h3><span class="header-section-number">2.7.5</span> Fitted output</h3>
<p>…</p>
</div>
<div id="in-sample-summary" class="section level3">
<h3><span class="header-section-number">2.7.6</span> In-sample summary</h3>
<p>…</p>
</div>
<div id="forecast" class="section level3">
<h3><span class="header-section-number">2.7.7</span> Forecast</h3>
<p>…</p>
<div id="walking-forward-forecasts" class="section level4">
<h4><span class="header-section-number">2.7.7.1</span> Walking forward forecasts</h4>
<p>…</p>
</div>
</div>
<div id="trading-strategy" class="section level3">
<h3><span class="header-section-number">2.7.8</span> Trading strategy</h3>
<p>…</p>
</div>
</div>
<div id="further-research" class="section level2">
<h2><span class="header-section-number">2.8</span> Discussion</h2>
<div id="the-statistical-model" class="section level3">
<h3><span class="header-section-number">2.8.1</span> The statistical model</h3>
<p>…</p>
</div>
<div id="the-financial-application" class="section level3">
<h3><span class="header-section-number">2.8.2</span> The financial application</h3>
<p>…</p>
<hr />
</div>
</div>
</div>
<div id="original-computing-environment" class="section level1">
<h1><span class="header-section-number">3</span> Original Computing Environment</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">writeLines</span>(<span class="kw">readLines</span>(<span class="kw">file.path</span>(<span class="kw">Sys.getenv</span>(<span class="st">&quot;HOME&quot;</span>), <span class="st">&quot;.R/Makevars&quot;</span>)))</code></pre></div>
<pre><code>## 
## CXXFLAGS=-O3 -mtune=native -march=native -Wno-unused-variable -Wno-unused-function</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">devtools::<span class="kw">session_info</span>(<span class="st">&quot;rstan&quot;</span>)</code></pre></div>
<pre><code>## Session info -------------------------------------------------------------</code></pre>
<pre><code>##  setting  value                       
##  version  R version 3.3.3 (2017-03-06)
##  system   x86_64, mingw32             
##  ui       RTerm                       
##  language (EN)                        
##  collate  Spanish_Argentina.1252      
##  tz       America/Buenos_Aires        
##  date     2017-07-29</code></pre>
<pre><code>## Packages -----------------------------------------------------------------</code></pre>
<pre><code>##  package      * version   date       source        
##  BH             1.62.0-1  2016-11-19 CRAN (R 3.3.2)
##  colorspace     1.3-2     2016-12-14 CRAN (R 3.3.3)
##  dichromat      2.0-0     2013-01-24 CRAN (R 3.3.2)
##  digest         0.6.12    2017-01-27 CRAN (R 3.3.3)
##  ggplot2        2.2.1     2016-12-30 CRAN (R 3.3.3)
##  graphics     * 3.3.3     2017-03-06 local         
##  grDevices    * 3.3.3     2017-03-06 local         
##  grid           3.3.3     2017-03-06 local         
##  gridExtra      2.2.1     2016-02-29 CRAN (R 3.3.3)
##  gtable         0.2.0     2016-02-26 CRAN (R 3.3.3)
##  inline         0.3.14    2015-04-13 CRAN (R 3.3.3)
##  labeling       0.3       2014-08-23 CRAN (R 3.3.2)
##  lattice        0.20-34   2016-09-06 CRAN (R 3.3.3)
##  lazyeval       0.2.0     2016-06-12 CRAN (R 3.3.3)
##  magrittr       1.5       2014-11-22 CRAN (R 3.3.3)
##  MASS           7.3-45    2016-04-21 CRAN (R 3.3.3)
##  Matrix         1.2-8     2017-01-20 CRAN (R 3.3.3)
##  methods      * 3.3.3     2017-03-06 local         
##  munsell        0.4.3     2016-02-13 CRAN (R 3.3.3)
##  plyr           1.8.4     2016-06-08 CRAN (R 3.3.3)
##  RColorBrewer   1.1-2     2014-12-07 CRAN (R 3.3.2)
##  Rcpp           0.12.10   2017-03-19 CRAN (R 3.3.3)
##  RcppEigen      0.3.2.9.1 2017-03-15 CRAN (R 3.3.3)
##  reshape2       1.4.2     2016-10-22 CRAN (R 3.3.3)
##  rstan          2.14.2    2017-03-19 CRAN (R 3.3.3)
##  scales         0.4.1     2016-11-09 CRAN (R 3.3.3)
##  StanHeaders    2.14.0-1  2017-01-09 CRAN (R 3.3.3)
##  stats        * 3.3.3     2017-03-06 local         
##  stats4         3.3.3     2017-03-06 local         
##  stringi        1.1.3     2017-03-21 CRAN (R 3.3.3)
##  stringr        1.2.0     2017-02-18 CRAN (R 3.3.3)
##  tibble         1.3.0     2017-04-01 CRAN (R 3.3.3)
##  tools          3.3.3     2017-03-06 local         
##  utils        * 3.3.3     2017-03-06 local</code></pre>
<hr />
</div>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>
<div id="refs" class="references">
<div id="ref-baum1967inequality">
<p>Baum, Leonard E., and J. A. Eagon. 1967. “An Inequality with Applications to Statistical Estimation for Probabilistic Functions of Markov Processes and to a Model for Ecology.” <em>Bulletin of the American Mathematical Society</em> 73 (3). American Mathematical Society (AMS): 360–64. doi:<a href="https://doi.org/10.1090/s0002-9904-1967-11751-8">10.1090/s0002-9904-1967-11751-8</a>.</p>
</div>
<div id="ref-baum1970maximization">
<p>Baum, Leonard E., Ted Petrie, George Soules, and Norman Weiss. 1970. “A Maximization Technique Occurring in the Statistical Analysis of Probabilistic Functions of Markov Chains.” <em>The Annals of Mathematical Statistics</em> 41 (1). Institute of Mathematical Statistics: 164–71. doi:<a href="https://doi.org/10.1214/aoms/1177697196">10.1214/aoms/1177697196</a>.</p>
</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>In Machine Learning terminology, a problem is divided into homogeneous regions addressed by an expert submodel. A gating network or function decides which expert to use for each input region.<a href="#fnref1">↩</a></p></li>
</ol>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
